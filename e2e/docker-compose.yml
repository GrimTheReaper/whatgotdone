version: '3.2'
services:
  whatgotdone:
    build:
      context: ../
      args:
        NPM_BUILD_CMD: build-staging
        BUILD_TAGS: staging
    environment:
      - PORT=3000
    volumes:
      - ../service-account-creds-staging.json:/app/service-account-creds-staging.json
      - ./cypress/videos:/app/e2e/cypress/videos
      - ./cypress/screenshots:/app/e2e/cypress/screenshots
    ports:
      - 3000:3000
  cypress:
    image: "cypress/included:3.3.0"
    depends_on:
      - whatgotdone
    environment:
      - CYPRESS_baseUrl=http://whatgotdone:3000
    working_dir: /e2e
    volumes:
      - ./:/e2e
